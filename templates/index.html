<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>XONITER - Remote Command Executor</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 18px; background:#f7f7f9; color:#222; }
    .container { max-width:900px; margin:0 auto; background:#fff; padding:18px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
    textarea { width:100%; height:160px; padding:10px; font-family: monospace; font-size:14px; }
    pre { background:#0b0b0b; color:#e6e6e6; padding:12px; border-radius:6px; overflow:auto; }
    input[type=text], input[type=number], button { padding:10px; margin-top:8px; }
    .warn { background:#fff3cd; padding:10px; border-radius:6px; color:#856404; }
    .info { background:#d1ecf1; padding:10px; border-radius:6px; color:#0c5460; }
    .success { background:#d4edda; padding:10px; border-radius:6px; color:#155724; }
    .meta { color:#555; font-size:0.9rem; }
    .btn { display:inline-block; padding:10px 20px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer; text-decoration:none; }
    .btn:hover { background:#0056b3; }
    .url-box { background:#e9ecef; padding:10px; border-radius:6px; font-family:monospace; word-break:break-all; margin:10px 0; }
  </style>
</head>
<body>                                                                                                                                                                                        
  <div class="container">                                                                                                                                                                     
    <h1>XONITER - Remote Command Executor</h1>                                                                                                                                                                   
    <p class="warn"><strong>WARNING:</strong> This page executes commands on the system. Do not expose to untrusted networks.</p>
    
    {% if sudo_active %}
    <div class="success">
      <strong>✓ Sudo Mode Enabled:</strong> Running with elevated privileges<br>
      <small>All commands will execute with sudo automatically</small>
    </div>
    {% else %}
    <div class="warn">
      <strong>⚠ Sudo Mode Disabled:</strong> Running without elevated privileges<br>
      <small>Commands will not have sudo permissions</small>
    </div>
    {% endif %}
    
    <!-- Access Information -->
    <div class="info">
      <h3>Server Access</h3>
      <p>Use one of these URLs to access from other devices:</p>
      <div class="url-box">{{ full_url }}</div>
      <p><small>Network: {{ network_info }}</small></p>
      <p><em>Note: Scan the QR code shown in the terminal for quick access</em></p>
    </div>
    
    <p class="meta">Server: <strong>{{ host }}:{{ port }}</strong> &nbsp; • &nbsp; User: <strong>{{ user }}</strong> &nbsp; • &nbsp; Sudo: <strong>{{ sudo_status }}</strong></p>                                                                  
                                                                                                                                                                                              
    <form method="post">                                                                                                                                                                      
      <label for="cmd">Command (paste full command or multiple commands):</label><br>                                                                                                     
      <textarea name="cmd" id="cmd" placeholder="Example: ls -la /home or uname -a">{{ cmd_escaped }}</textarea><br>                                                                              
      <label for="timeout">Timeout (seconds, empty = no limit):</label>                                                                                                                     
      <input type="number" name="timeout" id="timeout" min="1" value="{{ timeout_value }}"><br>                                                                                               
      <button type="submit" class="btn">Execute Command</button>                                                                                                                                                      
    </form>

    {% if ran %}
      <h3>Executed Command:</h3>
      <pre>{{ command }}</pre>

      {% if error %}
        <h3 style="color:crimson">Error:</h3>
        <pre style="color:crimson">{{ error }}</pre>
      {% endif %}

      <h3>STDOUT Output:</h3>
      <pre>{{ stdout }}</pre>

      <h3>STDERR Output:</h3>
      <pre>{{ stderr }}</pre>

      <p class="meta">Return code: <strong>{{ rc }}</strong> — Time: <strong>{{ elapsed }}</strong></p>
    {% endif %}

    <p class="meta">Tip: To limit exposure, bind to 127.0.0.1 or use a firewall. All commands execute with sudo if enabled.</p>
  </div>
</body>
</html>
